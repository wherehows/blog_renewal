---
date: '2023-03-11'
title: '3ì›” 2ì£¼ì°¨'
subTitle: '3ì›” 2ì£¼ì°¨'
grandParent: ''
parent: 'Weekly Journal'
slug: '/weekly-journal/2023-03-11'
---

## ğŸ“Œ axiosì™€ react-queryì˜ ìºì‹œ ë™ì‘

bfcache ì´ë¡ ì— ê·¼ê±°í•˜ë©´ ë’¤ë¡œê°€ê¸° í–ˆì„ ë•Œ ë°ì´í„° ìš”ì²­ì´ ë°œìƒí•˜ë©´ ì•ˆëœë‹¤. í•˜ì§€ë§Œ í˜„ì¬ í”„ë¡œì íŠ¸ëŠ” ë’¤ë¡œê°€ê¸° í–ˆì„ ë•Œ ë°ì´í„° ìš”ì²­ì´ ë°œìƒí•œë‹¤. íŒ€ì¥ë‹˜ê»˜ì„œ ì¼ì „ì— axiosê°€ ë¬´ì¡°ê±´ ë°ì´í„°ë¥¼ ìš”ì²­í•˜ë„ë¡ ì„¤ì •í•´ë†¨ëŠ”ë° í˜¹ì‹œ ì´ê²Œ ë¬¸ì œê°€ ë˜ëŠ”ê²Œ ì•„ë‹Œì§€ í™•ì¸í•´ ë´ë‹¬ë¼ê³  í•˜ì…¨ë‹¤. bfcacheê°€ ì• ì´ˆì— ë™ì‘í•˜ì§€ ì•Šê³  ìˆì–´ì„œ ì´ëŸ¬í•œ ì¶”ë¡ ì€ íƒ€ë‹¹í•˜ê¸° ì–´ë ¤ì›Œë³´ì˜€ì§€ë§Œ, axiosì˜ ìºì‹œ ì„¤ì •ê³¼ react-queryì˜ ìºì‹œ ì„¤ì •ì— ë”°ë¼ì„œ ìš”ì²­ì´ ì–´ë–»ê²Œ ì²˜ë¦¬ë˜ëŠ”ì§€ ê¶ê¸ˆí•´ì„œ í…ŒìŠ¤íŠ¸í•´ë´¤ë‹¤.

1. axios ë° react-query ëª¨ë‘ ìºì‹œë¥¼ ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ ë‹¹ì—°í•˜ê²Œë„ ë¬´ì¡°ê±´ì ì¸ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì´ ë°œìƒí•œë‹¤.
2. axios ìºì‹œ ì„¤ì •ì„ ì œê±°í•˜ê³ , react-query ìºì‹œ ì˜µì…˜ì„ ì„¤ì •í•˜ë©´ ìºì‹œëœ ë°ì´í„°ì— í•œí•´ì„œëŠ” ë„¤íŠ¸ì›Œí¬ ìš”ì²­ íƒ­ì— ìš”ì²­ í•­ëª©ì´ ë³´ì—¬ì§€ì§€ ì•ŠëŠ”ë‹¤.
3. react-query ìºì‹œ ì„¤ì •ì„ ì œê±°í•˜ê³ , axios ìºì‹œ ì˜µì…˜ì„ ì„¤ì •í•˜ë©´ ìºì‹œëœ ë°ì´í„°ì— í•œí•´ì„œëŠ” ë„¤íŠ¸ì›Œí¬ ìš”ì²­ íƒ­ì— ìš”ì²­ í•­ëª©ì´ ë³´ì—¬ì§€ì§€ë§Œ disk cacheë¡œë¶€í„° ë°˜í™˜ëœë‹¤.
4. axios ë° react-query ëª¨ë‘ ìºì‹œë¥¼ ì„¤ì •í•˜ë©´ ìºì‹œëœ ë°ì´í„°ì— í•œí•´ì„œëŠ” ë„¤íŠ¸ì›Œí¬ ìš”ì²­ íƒ­ì— ìš”ì²­ í•­ëª©ì´ ë³´ì—¬ì§€ì§€ ì•ŠëŠ”ë‹¤.

react-queryì—ì„œ ìºì‹±ì„ ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ axiosì—ì„œ ì„¤ì •í•´ë†“ì€ ìºì‹± ê²°ê³¼ê°€ ë™ì‘í•˜ëŠ” ê²ƒ ê°™ë‹¤. ë³„ê°œë¡œ disk cache ë¿ë§Œ ì•„ë‹ˆë¼ memory cacheë„ ì¡´ì¬í•˜ëŠ”ë°, [ë‘˜ì˜ ì°¨ì´](https://stackoverflow.com/questions/44596937/chrome-memory-cache-vs-disk-cache)ëŠ” disk cacheëŠ” ë°ì´í„°ê°€ í•˜ë“œ ë“œë¼ì´ë¸Œì— ì €ì¥ë˜ê³  íƒ­ì„ ë‹«ì•„ë„ ë°ì´í„°ê°€ ì‚¬ë¼ì§€ì§€ ì•ŠëŠ” ë¹„íœ˜ë°œì„± ê³µê°„ì¸ ë°˜ë©´ì— memory cacheëŠ” ë°ì´í„°ê°€ ramì— ì €ì¥ë˜ê³  íƒ­ì„ ë‹«ìœ¼ë©´ ì‚¬ë¼ì§€ëŠ” íœ˜ë°œì„± ë°ì´í„°ë¼ê³ í•œë‹¤.

## ğŸ“Œ usePreviousì— ê´€í•œ ì´í•´

ì‘ì—…ì„ í•˜ë©´ì„œ ì•„ë˜ ì½”ë“œì˜ ë™ì‘ì´ ì˜ ì´í•´ê°€ ì•ˆê°”ë‹¤.

![](./usePrevious.png)
[ì½”ë“œ ì¶œì²˜](https://codesandbox.io/s/pwnl6v7z6m)

App ì»´í¬ë„ŒíŠ¸ ë‚´ì˜ useEffect ë‚´ë¶€ì—ì„œ countì™€ prevCountë¥¼ ë¹„êµí•˜ë©´ prevCountê°€ í•­ìƒ ì´ì „ê°’ì„ ë³´ì—¬ì¤€ë‹¤. ëŒ€ë¶€ë¶„ì˜ ì‚¬ëŒë“¤ì˜ ê²½ìš° ë„ˆë¬´ë‚˜ ë‹¹ì—°í•˜ê²Œ ì´í•´í•  ìˆ˜ ìˆì—ˆì„ì§€ ëª¨ë¥´ê² ì§€ë§Œ, ë¶ˆí–‰í•˜ê²Œë„ ë‚˜ëŠ” ì•„ë‹ˆì—ˆë‹¤. ë‚´ê°€ ìƒê°í•œ ê²ƒì€ ë‹¤ìŒê³¼ ê°™ë‹¤. useEffectëŠ” ë Œë”ë§ì´ ëœ í›„ì— ì‹¤í–‰ëœë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ref.currentê°€ ì´í›„ì˜ ê°’ìœ¼ë¡œ ë°”ë€ŒëŠ” ê²ƒë„ ë Œë”ë§ì´ ëœ í›„ì´ë‹¤. ë”ë¶ˆì–´ì„œ App ì»´í¬ë„ŒíŠ¸ ë‚´ì˜ useEffect ë‚´ì˜ prevCountëŠ” ì´ë¯¸ ê°’ì´ ë°”ë€Œì–´ ìˆìœ¼ë¯€ë¡œ logì—ì„œ countì™€ prevCountê°€ ê°™ì€ ê°’ì„ ê°€ì ¸ì•¼í•œë‹¤. í•˜ì§€ë§Œ ê·¸ë ‡ì§€ ì•Šë‹¤.

ë‹µì€ ë„ˆë¬´ë‚˜ ê°„ë‹¨í•˜ê²Œë„ ë‹¤ìŒ ë¬¸ì— ìˆë‹¤.

```javascript
const prevCount = usePrevious(count);
```

ê·¸ëŸ¬ë‹ˆê¹Œ ì´ì „ ê°’ì„ prevCountë¼ëŠ” ë³€ìˆ˜ì— ì €ì¥í•˜ê³ , refë¼ëŠ” ì°¸ì¡°ê°’ì— ì ‘ê·¼í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— í•­ìƒ ì´ì „ê°’ì„ ë³´ì—¬ì¤„ ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤.

## ğŸ“Œ usePrevious ê°•í™”í•˜ê¸°

ë³¸ ëª©ì°¨ëŠ” [Implementing advanced usePrevious hook with React useRef](https://www.developerway.com/posts/implementing-advanced-use-previous-hook)ì˜ ë‚´ìš©ì„ ì •ë¦¬í–ˆë‹¤. usePrevious ì½”ë“œë¥¼ êµ¬ê¸€ë§í•´ë³´ë©´ ì¼ë°˜ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±ëœ ì½”ë“œë¥¼ ë³¼ìˆ˜ìˆë‹¤.

```javascript
const usePrevious = value => {
  const ref = useRef();

  useEffect(() => {
    ref.current = value;
  });

  return ref.current;
};
```

ê·¸ëŸ°ë° ì´ í›…ì€ í•œê°€ì§€ ë¬¸ì œì ì„ ì•ˆê³ ìˆë‹¤. valueê°€ ë°”ë€Œì§€ ì•Šì•˜ìŒì—ë„ ë¶ˆêµ¬í•˜ê³ , ë‹¤ë¥¸ ìƒíƒœì— ì˜í•´ì„œ ë¦¬ë Œë”ë§ì´ ë°œìƒí•˜ë©´ valueì™€ ref.currentê°€ ë™ì¼í•´ì§€ëŠ” ìˆœê°„ì´ ì˜¬ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤. ì˜ˆë¥¼ë“¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì½”ë“œê°€ ì‘ì„±ë¼ìˆë‹¤ê³  ê°€ì •í•´ë³´ì.

```javascript
function App() {
  const [count, setCount] = useState(0);
  const [_, forceRerender] = useState({});

  const prevCount = usePrevious(count);

  useEffect(() => {
    console.log(count, prevCount);
  }, [count, prevCount]);

  return (
    <div>
      <button onClick={() => forceRerender({})}>force rerender</button>
      <button onClick={() => setCount(count + 1)}>Increment</button>
    </div>
  );
}
```

ë§Œì•½ Increment ë²„íŠ¼ì„ ë„¤ë²ˆ ëˆ„ë¥´ë©´ useEffect ë‚´ì˜ logëŠ” ìˆœì„œëŒ€ë¡œ 3ê³¼ 2ë¥¼ ì°ì„ ê²ƒì´ë‹¤. í—Œë° ë§Œì•½ force rerender ë²„íŠ¼ì— ì˜í•´ì„œ ë¦¬ë Œë”ë§ì´ ë°œìƒí•˜ëŠ” ê²½ìš°, logëŠ” ìˆœì„œëŒ€ë¡œ 3ê³¼ 3ì„ ì°ê²Œëœë‹¤. countì˜ ìƒíƒœê°€ ë³€í•˜ì§€ ì•Šì•˜ìŒì—ë„ prevCountì˜ ê°’ì´ ë³€í•˜ëŠ” ê²ƒì´ë‹¤.

ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ usePreviousë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤. ì´ ê²½ìš° prev ìƒíƒœë¥¼ ì• ì´ˆì— ë“¤ê³  ìˆìœ¼ë¯€ë¡œ, ë Œë”ë§ì´ ëœ í›„ì— prev ê°’ì„ ë³€ê²½í•˜ë ¤ê³  useEffectë¥¼ êµ³ì´ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

```javascript
export const usePreviousPersistent = <TValue extends unknown>(
  value: TValue
) => {
  const ref = useRef<{ value: TValue; prev: TValue | null }>({
    value: value,
    prev: null
  });

  const current = ref.current.value;

  if (value !== current) {
    ref.current = {
      value: value,
      prev: current
    };
  }

  return ref.current.prev;
};
```

ë§Œì•½ ê°ì²´ë¥¼ ë¹„êµí•´ì•¼ í•˜ëŠ” ê²½ìš° deep equalityë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ì§€ë§Œ ê¸€ì“´ì´ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ë”°ë¼ì„œ ì†ë„ê°€ ëŠë¦´ ìˆ˜ ìˆì–´ì„œ ë³„ë¡œ ì„ í˜¸í•˜ì§€ ì•ŠëŠ”ë‹¤ê³  í•œë‹¤. ê·¸ë˜ì„œ matcher í•¨ìˆ˜ë¥¼ ì „ë‹¬í•˜ëŠ” ë‹¤ìŒ ë°©ì‹ì„ ì œì•ˆí•˜ê³  ìˆë‹¤.

```javascript
export const usePreviousPersistentWithMatcher = <TValue extends unknown>(
  value: TValue,
  isEqualFunc: (prev: TValue, next: TValue) => boolean
) => {
  const ref = useRef<{ value: TValue; prev: TValue | null }>({
    value: value,
    prev: null
  });

  const current = ref.current.value;

  if (isEqualFunc ? !isEqualFunc(current, value) : value !== current) {
    ref.current = {
      value: value,
      prev: current
    };
  }

  return ref.current.prev;
};
```
