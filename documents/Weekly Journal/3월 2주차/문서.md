---
date: '2023-03-11'
title: '3ì›” 2ì£¼ì°¨'
subTitle: '3ì›” 2ì£¼ì°¨'
grandParent: ''
parent: 'Weekly Journal'
slug: '/weekly-journal/2023-03-11'
---

## ğŸ“Œ axiosì™€ react-queryì˜ ìºì‹œ ë™ì‘

bfcache ì´ë¡ ì— ê·¼ê±°í•˜ë©´ ë’¤ë¡œê°€ê¸° í–ˆì„ ë•Œ ë°ì´í„° ìš”ì²­ì´ ë°œìƒí•˜ë©´ ì•ˆëœë‹¤. í•˜ì§€ë§Œ í˜„ì¬ í”„ë¡œì íŠ¸ëŠ” ë’¤ë¡œê°€ê¸° í–ˆì„ ë•Œ ë°ì´í„° ìš”ì²­ì´ ë°œìƒí•œë‹¤. íŒ€ì¥ë‹˜ê»˜ì„œ ì¼ì „ì— axiosê°€ ë¬´ì¡°ê±´ ë°ì´í„°ë¥¼ ìš”ì²­í•˜ë„ë¡ ì„¤ì •í•´ë†¨ëŠ”ë° í˜¹ì‹œ ì´ê²Œ ë¬¸ì œê°€ ë˜ëŠ”ê²Œ ì•„ë‹Œì§€ í™•ì¸í•´ ë´ë‹¬ë¼ê³  í•˜ì…¨ë‹¤. bfcacheê°€ ì• ì´ˆì— ë™ì‘í•˜ì§€ ì•Šê³  ìˆì–´ì„œ ì´ëŸ¬í•œ ì¶”ë¡ ì€ íƒ€ë‹¹í•˜ê¸° ì–´ë ¤ì›Œë³´ì˜€ì§€ë§Œ, axiosì˜ ìºì‹œ ì„¤ì •ê³¼ react-queryì˜ ìºì‹œ ì„¤ì •ì— ë”°ë¼ì„œ ìš”ì²­ì´ ì–´ë–»ê²Œ ì²˜ë¦¬ë˜ëŠ”ì§€ ê¶ê¸ˆí•´ì„œ í…ŒìŠ¤íŠ¸í•´ë´¤ë‹¤.

1. axios ë° react-query ëª¨ë‘ ìºì‹œë¥¼ ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ ë‹¹ì—°í•˜ê²Œë„ ë¬´ì¡°ê±´ì ì¸ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì´ ë°œìƒí•œë‹¤.
2. axios ìºì‹œ ì„¤ì •ì„ ì œê±°í•˜ê³ , react-query ìºì‹œ ì˜µì…˜ì„ ì„¤ì •í•˜ë©´ ìºì‹œëœ ë°ì´í„°ì— í•œí•´ì„œëŠ” ë„¤íŠ¸ì›Œí¬ ìš”ì²­ íƒ­ì— ìš”ì²­ í•­ëª©ì´ ë³´ì—¬ì§€ì§€ ì•ŠëŠ”ë‹¤.
3. react-query ìºì‹œ ì„¤ì •ì„ ì œê±°í•˜ê³ , axios ìºì‹œ ì˜µì…˜ì„ ì„¤ì •í•˜ë©´ ìºì‹œëœ ë°ì´í„°ì— í•œí•´ì„œëŠ” ë„¤íŠ¸ì›Œí¬ ìš”ì²­ íƒ­ì— ìš”ì²­ í•­ëª©ì´ ë³´ì—¬ì§€ì§€ë§Œ disk cacheë¡œë¶€í„° ë°˜í™˜ëœë‹¤.
4. axios ë° react-query ëª¨ë‘ ìºì‹œë¥¼ ì„¤ì •í•˜ë©´ ìºì‹œëœ ë°ì´í„°ì— í•œí•´ì„œëŠ” ë„¤íŠ¸ì›Œí¬ ìš”ì²­ íƒ­ì— ìš”ì²­ í•­ëª©ì´ ë³´ì—¬ì§€ì§€ ì•ŠëŠ”ë‹¤.

react-queryì—ì„œ ìºì‹±ì„ ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ axiosì—ì„œ ì„¤ì •í•´ë†“ì€ ìºì‹± ê²°ê³¼ê°€ ë™ì‘í•˜ëŠ” ê²ƒ ê°™ë‹¤. ë³„ê°œë¡œ disk cache ë¿ë§Œ ì•„ë‹ˆë¼ memory cacheë„ ì¡´ì¬í•˜ëŠ”ë°, [ë‘˜ì˜ ì°¨ì´](https://stackoverflow.com/questions/44596937/chrome-memory-cache-vs-disk-cache)ëŠ” disk cacheëŠ” ë°ì´í„°ê°€ í•˜ë“œ ë“œë¼ì´ë¸Œì— ì €ì¥ë˜ê³  íƒ­ì„ ë‹«ì•„ë„ ë°ì´í„°ê°€ ì‚¬ë¼ì§€ì§€ ì•ŠëŠ” ë¹„íœ˜ë°œì„± ê³µê°„ì¸ ë°˜ë©´ì— memory cacheëŠ” ë°ì´í„°ê°€ ramì— ì €ì¥ë˜ê³  íƒ­ì„ ë‹«ìœ¼ë©´ ì‚¬ë¼ì§€ëŠ” íœ˜ë°œì„± ë°ì´í„°ë¼ê³ í•œë‹¤.

## ğŸ“Œ usePreviousì— ê´€í•œ ì´í•´

ì‘ì—…ì„ í•˜ë©´ì„œ ì•„ë˜ ì½”ë“œì˜ ë™ì‘ì´ ì˜ ì´í•´ê°€ ì•ˆê°”ë‹¤.

![](./usePrevious.png)
[ì½”ë“œ ì¶œì²˜](https://codesandbox.io/s/pwnl6v7z6m)

App ì»´í¬ë„ŒíŠ¸ ë‚´ì˜ useEffect ë‚´ë¶€ì—ì„œ countì™€ prevCountë¥¼ ë¹„êµí•˜ë©´ prevCountê°€ í•­ìƒ ì´ì „ê°’ì„ ë³´ì—¬ì¤€ë‹¤. ëŒ€ë¶€ë¶„ì˜ ì‚¬ëŒë“¤ì˜ ê²½ìš° ë„ˆë¬´ë‚˜ ë‹¹ì—°í•˜ê²Œ ì´í•´í•  ìˆ˜ ìˆì—ˆì„ì§€ ëª¨ë¥´ê² ì§€ë§Œ, ë¶ˆí–‰í•˜ê²Œë„ ë‚˜ëŠ” ì•„ë‹ˆì—ˆë‹¤. ë‚´ê°€ ìƒê°í•œ ê²ƒì€ ë‹¤ìŒê³¼ ê°™ë‹¤. useEffectëŠ” ë Œë”ë§ì´ ëœ í›„ì— ì‹¤í–‰ëœë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ref.currentê°€ ì´í›„ì˜ ê°’ìœ¼ë¡œ ë°”ë€ŒëŠ” ê²ƒë„ ë Œë”ë§ì´ ëœ í›„ì´ë‹¤. ë”ë¶ˆì–´ì„œ App ì»´í¬ë„ŒíŠ¸ ë‚´ì˜ useEffect ë‚´ì˜ prevCountëŠ” ì´ë¯¸ ê°’ì´ ë°”ë€Œì–´ ìˆìœ¼ë¯€ë¡œ logì—ì„œ countì™€ prevCountê°€ ê°™ì€ ê°’ì„ ê°€ì ¸ì•¼í•œë‹¤. í•˜ì§€ë§Œ ê·¸ë ‡ì§€ ì•Šë‹¤.

ë‹µì€ ë„ˆë¬´ë‚˜ ê°„ë‹¨í•˜ê²Œë„ ë‹¤ìŒ ë¬¸ì— ìˆë‹¤.

```javascript
const prevCount = usePrevious(count);
```

ê·¸ëŸ¬ë‹ˆê¹Œ ì´ì „ ê°’ì„ prevCountë¼ëŠ” ë³€ìˆ˜ì— ì €ì¥í•˜ê³ , refë¼ëŠ” ì°¸ì¡°ê°’ì— ì ‘ê·¼í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— í•­ìƒ ì´ì „ê°’ì„ ë³´ì—¬ì¤„ ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤.

## ğŸ“Œ usePrevious ê°•í™”í•˜ê¸°

ë³¸ ëª©ì°¨ëŠ” [Implementing advanced usePrevious hook with React useRef](https://www.developerway.com/posts/implementing-advanced-use-previous-hook)ì˜ ë‚´ìš©ì„ ì •ë¦¬í–ˆë‹¤. usePrevious ì½”ë“œë¥¼ êµ¬ê¸€ë§í•´ë³´ë©´ ì¼ë°˜ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±ëœ ì½”ë“œë¥¼ ë³¼ìˆ˜ìˆë‹¤.

```javascript
const usePrevious = value => {
  const ref = useRef();

  useEffect(() => {
    ref.current = value;
  });

  return ref.current;
};
```

ê·¸ëŸ°ë° ì´ í›…ì€ í•œê°€ì§€ ë¬¸ì œì ì„ ì•ˆê³ ìˆë‹¤. valueê°€ ë°”ë€Œì§€ ì•Šì•˜ìŒì—ë„ ë¶ˆêµ¬í•˜ê³ , ë‹¤ë¥¸ ìƒíƒœì— ì˜í•´ì„œ ë¦¬ë Œë”ë§ì´ ë°œìƒí•˜ë©´ valueì™€ ref.currentê°€ ë™ì¼í•´ì§€ëŠ” ìˆœê°„ì´ ì˜¬ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤. ì˜ˆë¥¼ë“¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì½”ë“œê°€ ì‘ì„±ë¼ìˆë‹¤ê³  ê°€ì •í•´ë³´ì.

```javascript
function App() {
  const [count, setCount] = useState(0);
  const [_, forceRerender] = useState({});

  const prevCount = usePrevious(count);

  useEffect(() => {
    console.log(count, prevCount);
  }, [count, prevCount]);

  return (
    <div>
      <button onClick={() => forceRerender({})}>force rerender</button>
      <button onClick={() => setCount(count + 1)}>Increment</button>
    </div>
  );
}
```

ë§Œì•½ Increment ë²„íŠ¼ì„ ë„¤ë²ˆ ëˆ„ë¥´ë©´ useEffect ë‚´ì˜ logëŠ” ìˆœì„œëŒ€ë¡œ 3ê³¼ 2ë¥¼ ì°ì„ ê²ƒì´ë‹¤. í—Œë° ë§Œì•½ force rerender ë²„íŠ¼ì— ì˜í•´ì„œ ë¦¬ë Œë”ë§ì´ ë°œìƒí•˜ëŠ” ê²½ìš°, logëŠ” ìˆœì„œëŒ€ë¡œ 3ê³¼ 3ì„ ì°ê²Œëœë‹¤. countì˜ ìƒíƒœê°€ ë³€í•˜ì§€ ì•Šì•˜ìŒì—ë„ prevCountì˜ ê°’ì´ ë³€í•˜ëŠ” ê²ƒì´ë‹¤.

ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ usePreviousë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤. ì´ ê²½ìš° prev ìƒíƒœë¥¼ ì• ì´ˆì— ë“¤ê³  ìˆìœ¼ë¯€ë¡œ, ë Œë”ë§ì´ ëœ í›„ì— prev ê°’ì„ ë³€ê²½í•˜ë ¤ê³  useEffectë¥¼ êµ³ì´ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

```javascript
export const usePreviousPersistent = <TValue extends unknown>(
  value: TValue
) => {
  const ref = useRef<{ value: TValue; prev: TValue | null }>({
    value: value,
    prev: null
  });

  const current = ref.current.value;

  if (value !== current) {
    ref.current = {
      value: value,
      prev: current
    };
  }

  return ref.current.prev;
};
```

ë§Œì•½ ê°ì²´ë¥¼ ë¹„êµí•´ì•¼ í•˜ëŠ” ê²½ìš° deep equalityë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ì§€ë§Œ ê¸€ì“´ì´ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ë”°ë¼ì„œ ì†ë„ê°€ ëŠë¦´ ìˆ˜ ìˆì–´ì„œ ë³„ë¡œ ì„ í˜¸í•˜ì§€ ì•ŠëŠ”ë‹¤ê³  í•œë‹¤. ê·¸ë˜ì„œ matcher í•¨ìˆ˜ë¥¼ ì „ë‹¬í•˜ëŠ” ë‹¤ìŒ ë°©ì‹ì„ ì œì•ˆí•˜ê³  ìˆë‹¤.

```javascript
export const usePreviousPersistentWithMatcher = <TValue extends unknown>(
  value: TValue,
  isEqualFunc: (prev: TValue, next: TValue) => boolean
) => {
  const ref = useRef<{ value: TValue; prev: TValue | null }>({
    value: value,
    prev: null
  });

  const current = ref.current.value;

  if (isEqualFunc ? !isEqualFunc(current, value) : value !== current) {
    ref.current = {
      value: value,
      prev: current
    };
  }

  return ref.current.prev;
};
```

### ğŸ“Œ localStorage ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•˜ê¸°

ë³¸ì¸ì´ í”„ë¡œê·¸ë˜ë¨¸ìŠ¤ ë°ë¸Œì½”ìŠ¤ë¥¼ ìˆ˜ê°•í•  ë•Œ ë°”ë‹ë¼ ìë°”ìŠ¤í¬ë¦½íŠ¸ ë©˜í† ë‹˜ê»˜ì„œ localStorageë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•˜ì…¨ë‹¤.

```javascript
const storage = window.localStorage;

const getItem = (key, fallbackValue) => {
  try {
    const res = storage.getItem(key);

    return res ? JSON.parse(res) : fallbackValue;
  } catch (e) {
    console.error(e.message);
    return fallbackValue;
  }
};

export default {
  getItem,
  setItem,
};
```

ìœ„ ì½”ë“œì˜ getItem ë‚´ë¶€ì—ì„œ ì™œ try ~ catch ë¬¸ì„ ì¨ì•¼í•˜ëŠ”ì§€ë‹¤. ë‹¹ì‹œì— ì›Œë‚™ ìˆ˜ì—… ë”°ë¼ê°€ê¸°ë„ í˜ë“¤ì—ˆì–´ì„œ ì œëŒ€ë¡œ ì§šê³  ë„˜ì–´ê°€ì§€ ëª»í•œ ë¶€ë¶„ì´ì—ˆëŠ”ë°, í•˜í•„ ê°•ì‚¬ë‹˜ì´ ê³„ì‹  íšŒì‚¬ì— ë©´ì ‘ì„ ë³´ëŸ¬ê°”ì„ ë•Œ ê°•ì‚¬ë‹˜ê»˜ì„œ ì™œ ì €ë ‡ê²Œ ì‘ì„±í•œê±´ì§€ ì•Œê³  ìˆëƒê³  ë¬¼ì–´ë³´ì…¨ì—ˆë‹¤. ê·¸ ë‹¹ì‹œì— ê°•ì‚¬ë‹˜ê»˜ì„œ ì´ìœ ë¥¼ ì•Œë ¤ì£¼ì…¨ì—ˆëŠ”ë°, ì´ë²ˆì— ë°ë¸Œë§¤ì¹­ ì‹œí—˜ì„ ê³µë¶€í•˜ë©´ì„œ ì´ìœ ë¥¼ ê¹Œë¨¹ì–´ ë‹¤ì‹œ ì°¾ì•„ë³´ì•˜ë‹¤.

ìš°ì„  ê°•ì‚¬ë‹˜ì´ ì•Œë ¤ì£¼ì‹  ì´ìœ ì™€ ë³„ê°œë¡œ í•œê°€ì§€ ì´ìœ ê°€ ë” ì¡´ì¬í•˜ëŠ”ë° ë‹¤ìŒê³¼ ê°™ë‹¤.

1. JSON.parseì‹œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì—ëŸ¬
2. localStorageê°€ ì§€ì›ë˜ì§€ ì•ŠëŠ” í™˜ê²½ì—ì„œ ë°œìƒí•˜ëŠ” ì—ëŸ¬

1ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. storageì— ì €ì¥í•  ë•ŒëŠ” JSON.stringifyë¥¼ ì´ìš©í•´ì„œ ì €ì¥í•˜ëŠ”ë° ì–´ë–¤ ê²½ìœ ë¡œ `{ a : 1` ì´ë¼ëŠ” ê°ì²´ê°€ ì €ì¥ëë‹¤ê³  ê°€ì •í•´ë³´ì. ê·¸ë¦¬ê³  ì´ ê°ì²´ë¥¼ ë‹¤ì‹œ ê°€ì ¸ì™€ì„œ JSON.parse í•˜ë ¤ê³  í• ë•Œ ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí•˜ê²Œ ëœë‹¤.

![](./try-catch.png)

ì—ëŸ¬ê°€ ì˜ë¯¸í•˜ëŠ”ëŒ€ë¡œ, ë‘ë²ˆì§¸ í”„ë¡œí¼í‹°(at position2)ê°€ ì™€ì•¼í•˜ëŠ”ë° ìƒëµì´ ë˜ì—ˆê±°ë‚˜, ë‘ë²ˆì§¸ í”„ë¡œí¼í‹°ê°€ ì˜¤ì§€ëŠ” ì•ŠëŠ”ë° `}`ë¥¼ ê¸°ì…í•˜ì§€ ì•Šì•„ì„œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ë‹¤. ë§Œì•½ ì•„ë˜ì™€ ê°™ì´ try ~ catchë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ í”„ë¡œê·¸ë¨ì´ ë©ˆì¶œìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì— catch ë¬¸ì—ì„œ ì—ëŸ¬ë¥¼ í¬ì°©í•˜ì—¬ fallbackValueë¥¼ ë‚´ë†“ëŠ” ê²ƒì´ë‹¤.

```javascript
const res = JSON.parse(localStorage.getItem(2)); // ì—ëŸ¬ ë°œìƒ
console.log(res); // ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
```

2ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. ìš°ì„  [Can i use?](https://caniuse.com/)ë¥¼ í†µí•´ localStorageì™€ sessionStorageê°€ ì–´ë–¤ ë¸Œë¼ìš°ì €ì—ì„œ ì§€ì›ë˜ì§€ ì•ŠëŠ”ì§€ ì°¾ì•„ë´¤ë‹¤.

localStorageëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.
![](./localStorage.png);

sessionStorageëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.
![](./sessionStorage.png);

ê·¸ë ‡ë‹¤ë©´ ì´ë ‡ê²Œ ì§€ì›ì´ ì•ˆë˜ëŠ” ìƒí™©ì—ì„œ ì½”ë“œê°€ ì‘ë™í•˜ë„ë¡ í•˜ê¸° ìœ„í•´ì„œëŠ” ì–´ë–»ê²Œ ì‘ì„±í•´ì•¼ í• ê¹Œ? [How to Use LocalStorage Safely](https://javascript.plainenglish.io/how-to-use-localstorage-safely-a96eb50fbb4e)ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì œì‹œí•˜ê³  ìˆë‹¤.

```javascript
function isSupportLS() {
  try {
    localStorage.setItem('_ranger-test-key', 'hi');
    localStorage.getItem('_ranger-test-key');
    localStorage.removeItem('_ranger-test-key');
    return true;
  } catch (e) {
    return false;
  }
}

class Memory {
  constructor() {
    this.cache = {};
  }
  setItem(cacheKey, data) {
    this.cache[cacheKey] = data;
  }
  getItem(cacheKey) {
    return this.cache[cacheKey];
  }
  removeItem(cacheKey) {
    this.cache[cacheKey] = undefined;
  }
}

export const storage = isSupportLS() ? window.localStorage : new Memory();
```

ê·¸ëŸ¬ë‹ˆê¹Œ isSupportLS í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ì—¬ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ë¸Œë¼ìš°ì € ì €ì¥ì†Œê°€ ì•„ë‹Œ ì›¹ì‚¬ì´íŠ¸ ë‚´ë¶€ì˜ Memoryì— ì €ì¥í•˜ëŠ” ë°©ë²•ì„ ì œì‹œí•˜ê³  ìˆë‹¤. í•˜ì§€ë§Œ [Javascript Try Catch for Localstorage Detection](https://stackoverflow.com/questions/14154478/javascript-try-catch-for-localstorage-detection)ì—ì„œ isSupportLS ë³´ë‹¤ ë” ê°„ë‹¨í•˜ê²Œ, ê·¸ë¦¬ê³  Edge caseê¹Œì§€ ê³ ë ¤í•˜ì—¬ ì‘ì„±í•˜ëŠ” ë°©ë²•ì„ ì œì‹œí•˜ê³  ìˆë‹¤.

```javascript
function supports_html5_storage() {
  try {
    return 'localStorage' in window && window['localStorage'] !== null;
  } catch (e) {
    return false;
  }
}
```

í•´ë‹¹ ê²Œì‹œê¸€ì„ ë“¤ì–´ê°€ë©´ ì•Œê² ì§€ë§Œ, ìœ„ í•¨ìˆ˜ì—ì„œ try ~ catch ë¬¸ì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” ì˜¤ë˜ëœ FirefoxëŠ” ì¿ í‚¤ ì‚¬ìš©ì„ êº¼ë†¨ì„ ë•Œ ì˜ˆì™¸ê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë²„ê·¸ê°€ ìˆë‹¤ê³  í•œë‹¤.

ê·¸ëŸ¬ë¯€ë¡œ ì½”ë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì™„ì„±í•  ìˆ˜ ìˆê²Œëœë‹¤.

```javascript
function supports_html5_storage() {
  try {
    return 'localStorage' in window && window['localStorage'] !== null;
  } catch (e) {
    return false;
  }
}

class Memory {
  constructor() {
    this.cache = {};
  }
  setItem(cacheKey, data) {
    this.cache[cacheKey] = data;
  }
  getItem(cacheKey) {
    return this.cache[cacheKey];
  }
  removeItem(cacheKey) {
    this.cache[cacheKey] = undefined;
  }
}

export const storage = supports_html5_storage()
  ? window.localStorage
  : new Memory();
```
